using IDS.Core.V2.Utilities;
using IDS.Core.V2.Visualization;
using IDS.Core.Visualization;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Drawing;

namespace IDS.Testing.UnitTests
{
    [TestClass]
    public class DrawUtilitiesTests
    {
        [TestMethod]
        public void InterpolateColor()
        {
            // Expand for color scales with more than one gradient (i.e. more than two colors)

            var color1 = Color.FromArgb(184, 31, 252);
            var color2 = Color.FromArgb(161, 166, 87);

            var randomScale = new ColorScale(new double[] { 0.72, 0.63 }, 
                                                    new double[] { 0.12, 0.65 },
                                                    new double[] { 0.99, 0.34 });

            const double min = 1;
            const double max = 4;

            var expectedInterpolation = new double[][] {new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.72,    0.12,    0.99},
                                                                new double[] {0.717,   0.137666667, 0.968333333},
                                                                new double[] {0.714,   0.155333333, 0.946666667},
                                                                new double[] {0.711,   0.173,   0.925},
                                                                new double[] {0.708,   0.190666667, 0.903333333},
                                                                new double[] {0.705,   0.208333333, 0.881666667},
                                                                new double[] {0.702,   0.226,   0.86},
                                                                new double[] {0.699,   0.243666667, 0.838333333},
                                                                new double[] {0.696,   0.261333333, 0.816666667},
                                                                new double[] {0.693,   0.279,   0.795},
                                                                new double[] {0.69,    0.296666667, 0.773333333},
                                                                new double[] {0.687,   0.314333333, 0.751666667},
                                                                new double[] {0.684,   0.332,   0.73},
                                                                new double[] {0.681,   0.349666667, 0.708333333},
                                                                new double[] {0.678,   0.367333333, 0.686666667},
                                                                new double[] {0.675,   0.385,   0.665},
                                                                new double[] {0.672,   0.402666667, 0.643333333},
                                                                new double[] {0.669,   0.420333333, 0.621666667},
                                                                new double[] {0.666,   0.438,   0.6},
                                                                new double[] {0.663,   0.455666667, 0.578333333},
                                                                new double[] {0.66,    0.473333333, 0.556666667},
                                                                new double[] {0.657,   0.491,   0.535},
                                                                new double[] {0.654,   0.508666667, 0.513333333},
                                                                new double[] {0.651,   0.526333333, 0.491666667},
                                                                new double[] {0.648,   0.544,   0.47},
                                                                new double[] {0.645,   0.561666667, 0.448333333},
                                                                new double[] {0.642,   0.579333333, 0.426666667},
                                                                new double[] {0.639,   0.597,   0.405},
                                                                new double[] {0.636,   0.614666667, 0.383333333},
                                                                new double[] {0.633,   0.632333333, 0.361666667},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34},
                                                                new double[] {0.63,    0.65,    0.34}};


            var i = 0;
            for(double value = -1; value <= max + 1; value += 0.1)
            {
                var actualInterpolation = DrawUtilitiesV2.InterpolateColorScale(value, min, max, randomScale);

                const double delta = 1e-8;
                Assert.AreEqual(expectedInterpolation[i][0], actualInterpolation[0], delta);
                Assert.AreEqual(expectedInterpolation[i][1], actualInterpolation[1], delta);
                Assert.AreEqual(expectedInterpolation[i][2], actualInterpolation[2], delta);

                i++;
            }


        }

        [TestMethod]
        public void FeaVisualisationColors()
        {
            var fatigueValues = new double[] { 0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 4, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 5, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9, 6, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9, 7, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9, 8, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9, 9, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9, 10, 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7, 10.8, 10.9, 11 };
            const double safetyLow = 2;
            const double safetyMiddle = 5;
            const double safetyHigh = 10;

            var expectedRgb = new int[][]{new int[]{255, 0,   0},
                                            new int[]{255, 12,  0},
                                            new int[]{255, 25,  0},
                                            new int[]{255, 38,  0},
                                            new int[]{255, 51,  0},
                                            new int[]{255, 63,  0},
                                            new int[]{255, 76,  0},
                                            new int[]{255, 89,  0},
                                            new int[]{255, 102, 0},
                                            new int[]{255, 114, 0},
                                            new int[]{255, 127, 0},
                                            new int[]{255, 140, 0},
                                            new int[]{255, 153, 0},
                                            new int[]{255, 165, 0},
                                            new int[]{255, 178, 0},
                                            new int[]{255, 191, 0},
                                            new int[]{255, 204, 0},
                                            new int[]{255, 216, 0},
                                            new int[]{255, 229, 0},
                                            new int[]{255, 242, 0},
                                            new int[]{255, 255, 0},
                                            new int[]{246, 255, 8},
                                            new int[]{238, 255, 17},
                                            new int[]{229, 255, 25},
                                            new int[]{221, 255, 34},
                                            new int[]{212, 255, 42},
                                            new int[]{204, 255, 51},
                                            new int[]{195, 255, 59},
                                            new int[]{187, 255, 68},
                                            new int[]{178, 255, 76},
                                            new int[]{170, 255, 85},
                                            new int[]{161, 255, 93},
                                            new int[]{153, 255, 102},
                                            new int[]{144, 255, 110},
                                            new int[]{136, 255, 119},
                                            new int[]{127, 255, 127},
                                            new int[]{119, 255, 136},
                                            new int[]{110, 255, 144},
                                            new int[]{102, 255, 153},
                                            new int[]{93,  255, 161},
                                            new int[]{84,  255, 170},
                                            new int[]{76,  255, 178},
                                            new int[]{67,  255, 187},
                                            new int[]{59,  255, 195},
                                            new int[]{51,  255, 204},
                                            new int[]{42,  255, 212},
                                            new int[]{34,  255, 221},
                                            new int[]{25,  255, 229},
                                            new int[]{17,  255, 238},
                                            new int[]{8,   255, 246},
                                            new int[]{0,   255, 255},
                                            new int[]{0,   249, 255},
                                            new int[]{0,   244, 255},
                                            new int[]{0,   239, 255},
                                            new int[]{0,   234, 255},
                                            new int[]{0,   229, 255},
                                            new int[]{0,   224, 255},
                                            new int[]{0,   219, 255},
                                            new int[]{0,   214, 255},
                                            new int[]{0,   209, 255},
                                            new int[]{0,   204, 255},
                                            new int[]{0,   198, 255},
                                            new int[]{0,   193, 255},
                                            new int[]{0,   188, 255},
                                            new int[]{0,   183, 255},
                                            new int[]{0,   178, 255},
                                            new int[]{0,   173, 255},
                                            new int[]{0,   168, 255},
                                            new int[]{0,   163, 255},
                                            new int[]{0,   158, 255},
                                            new int[]{0,   153, 255},
                                            new int[]{0,   147, 255},
                                            new int[]{0,   142, 255},
                                            new int[]{0,   137, 255},
                                            new int[]{0,   132, 255},
                                            new int[]{0,   127, 255},
                                            new int[]{0,   122, 255},
                                            new int[]{0,   117, 255},
                                            new int[]{0,   112, 255},
                                            new int[]{0,   107, 255},
                                            new int[]{0,   102, 255},
                                            new int[]{0,   96,  255},
                                            new int[]{0,   91,  255},
                                            new int[]{0,   86,  255},
                                            new int[]{0,   81,  255},
                                            new int[]{0,   76,  255},
                                            new int[]{0,   71,  255},
                                            new int[]{0,   66,  255},
                                            new int[]{0,   61,  255},
                                            new int[]{0,   56,  255},
                                            new int[]{0,   51,  255},
                                            new int[]{0,   45,  255},
                                            new int[]{0,   40,  255},
                                            new int[]{0,   35,  255},
                                            new int[]{0,   30,  255},
                                            new int[]{0,   25,  255},
                                            new int[]{0,   20,  255},
                                            new int[]{0,   15,  255},
                                            new int[]{0,   10,  255},
                                            new int[]{0,   5,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255},
                                            new int[]{0,   0,   255}};



            for (var i = 0; i < fatigueValues.Length; i++)
            {
                var actualColor = DrawUtilities.ConvertFatigueValueToColor(fatigueValues[i], safetyLow, safetyMiddle, safetyHigh);
                Assert.AreEqual(expectedRgb[i][0], (int)actualColor.R, 1, $"Fatigue {fatigueValues[i]:F2} red");
                Assert.AreEqual(expectedRgb[i][1], (int)actualColor.G, 1, $"Fatigue {fatigueValues[i]:F2} green");
                Assert.AreEqual(expectedRgb[i][2], (int)actualColor.B, 1, $"Fatigue {fatigueValues[i]:F2} blue");
            }
        }

        //[TestMethod]
        //public void VonMisesRoundingForDrawing()
        //{
        //    double[] inputValues = new double[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240 };
        //    double[] expected = new double[] { 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 18.46153846, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 36.92307692, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 55.38461538, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 73.84615385, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 92.30769231, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 110.7692308, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 129.2307692, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 147.6923077, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 166.1538462, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 184.6153846, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 203.0769231, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 221.5384615, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240 };

        //    for(int i = 0; i < inputValues.Length; i++)
        //    {
        //        Assert.AreEqual(expected[i], DrawUtilities.RoundScalarToVonMisesStepValue(inputValues[i], 0, 240, 13), 1e-07);
        //    }
        //}
    }
}
