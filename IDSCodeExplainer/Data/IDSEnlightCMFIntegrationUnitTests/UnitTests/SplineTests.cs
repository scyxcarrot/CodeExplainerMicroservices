using IDS.EnlightCMFIntegration.DataModel;
using IDS.EnlightCMFIntegration.Operations;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Collections.Generic;
using System.Linq;

namespace IDSEnlightCMFIntegration.Testing.UnitTests
{
    [TestClass]
    public class SplineTests
    {
        [TestMethod]
        public void Spline_Exported_From_Integration_Has_Same_Property_Values()
        {
            var resource = new TestResources();

            //Arrange
            var geometryPointsFromMimics = new double[,]
            {
                { 23.510902404785156, -233.0127410888672, -173.82150268554688 },
                { 24.408477783203125, -230.76953125, -173.18109130859375 },
                { 25.303062438964844, -228.55409240722656, -172.47987365722656 },
                { 26.19465446472168, -226.36642456054688, -171.71783447265625 },
                { 27.083253860473633, -224.20651245117188, -170.89498901367188 },
                { 27.968860626220703, -222.0743865966797, -170.01133728027344 },
                { 28.851476669311523, -219.97003173828125, -169.06687927246094 },
                { 29.73110008239746, -217.89346313476562, -168.0615997314453 },
                { 30.607736587524414, -215.8446502685547, -166.99549865722656 },
                { 31.206981658935547, -214.4561309814453, -166.22950744628906 },
                { 31.804819107055664, -213.08067321777344, -165.4349365234375 },
                { 32.40125274658203, -211.71826171875, -164.6117706298828 },
                { 32.99627685546875, -210.368896484375, -163.76004028320312 },
                { 33.5874137878418, -209.04092407226562, -162.8749542236328 },
                { 34.17255401611328, -207.74179077148438, -161.95115661621094 },
                { 34.75168991088867, -206.47149658203125, -160.98867797851562 },
                { 35.324832916259766, -205.23004150390625, -159.9875030517578 },
                { 35.898170471191406, -204.0042724609375, -158.93600463867188 },
                { 36.46538162231445, -202.8079833984375, -157.84495544433594 },
                { 37.02646255493164, -201.6411895751953, -156.71437072753906 },
                { 37.58141326904297, -200.5038604736328, -155.5442352294922 },
                { 38.12709045410156, -199.40451049804688, -154.33485412597656 },
                { 38.66068649291992, -198.3508758544922, -153.08583068847656 },
                { 39.18220520019531, -197.343017578125, -151.79718017578125 },
                { 39.691646575927734, -196.38087463378906, -150.4688720703125 },
                { 40.235084533691406, -195.38082885742188, -148.97047424316406 },
                { 40.76406478881836, -194.4355010986328, -147.4246368408203 },
                { 41.02855682373047, -193.9619140625, -146.65460205078125 },
                { 41.30027389526367, -193.45909118652344, -145.91407775878906 },
                { 41.57920837402344, -192.9270477294922, -145.20306396484375 },
                { 41.86537170410156, -192.3657684326172, -144.52154541015625 },
                { 42.13310623168945, -191.82748413085938, -143.9247283935547 },
                { 42.4068717956543, -191.2647705078125, -143.3525390625 },
                { 42.68666458129883, -190.67770385742188, -142.80499267578125 },
                { 42.97248458862305, -190.06622314453125, -142.2820587158203 },
                { 43.26433563232422, -189.43035888671875, -141.78375244140625 },
                { 43.56221008300781, -188.7700958251953, -141.31008911132812 },
                { 43.86611557006836, -188.08546447753906, -140.8610382080078 },
                { 44.17604446411133, -187.3764190673828, -140.43661499023438 }
            };

            //Act: Retrieve spline's geometry points and diameter values from mcs file using integration project
            var reader = new EnlightCMFReader(resource.EnlightCmfFilePath);

            List<SplineProperties> splines;
            reader.GetAllSplineProperties(out splines);

            var splinePropertiesFromIntegration = splines.First(s => s.Name.ToUpper() == "03LEFT NERVE");

            //Assert
            Assert.AreEqual(2.5, splinePropertiesFromIntegration.Diameter, 0.001);

            for (var i = 0; i < geometryPointsFromMimics.GetLength(0); i++)
            {
                for (var j = 0; j < geometryPointsFromMimics.GetLength(1); j++)
                {
                    Assert.AreEqual(geometryPointsFromMimics[i, j], splinePropertiesFromIntegration.GeometryPoints[i, j], 0.001);
                }
            }
        }
    }
}
